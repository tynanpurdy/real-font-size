<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Real Text Size</title>
  </head>
  <body>
    <h1>Real Text Size</h1>
    <p>Pick a font</p>
    <!-- <div id="font-picker"></div> -->

    <label for="typeSizeInput"
      >Size:
      <div id="typeSizeInputs" style="display: flex; flex-direction: row">
        <input
          type="number"
          class="form-control"
          id="typeSizeInput"
          min="1"
          max="400"
          value="240"
        />

        <select class="form-control" id="typeUnitsInput">
          <option value="px">px</option>
          <option value="pt">pt</option>
        </select>
      </div></label
    >

    <canvas
      id="Canvas"
      width="1000"
      height="600"
      style="border: 1px solid black"
    ></canvas>

    <div id="fakeHeight"></div>
    <div id="realHeight"></div>

    <script src="FontPicker.ts"></script>
    <script>
      // const fontPicker = new FontPicker(
      // 	"", // Google API key
      // 	"Arial", // Default font
      // 	{ limit: 30 }, // Additional options
      // );

      let typeSizeInput = document.getElementById("typeSizeInput");
      let typeSize = typeSizeInput.value;
      let typeUnitsInput = document.getElementById("typeUnitsInput");
      let typeUnits = typeUnitsInput.value;
      let testFontStyle = "240pt Arial";
      typeSizeInputs.addEventListener("change", () => {
        typeSize = typeSizeInput.value;
        typeUnits = typeUnitsInput.value;

        drawPreview();
      });

      // set up canvas
      const c = document.getElementById("Canvas"); // get canvas element
      const ctx = c.getContext("2d"); // classify it as a 2D space
      c.style.width = "500px";
      c.style.height = "300px";

      const sampleText = "Apd";
      const sampleTextX = 50;
      const sampleTextY = 400;

      function drawPreview() {
        ctx.clearRect(0, 0, c.width, c.height);
        // const testFontStyle = typeSize + typeUnits + " " + currentFont;
        testFontStyle = `${typeSize}${typeUnits} Arial`;
        ctx.font = testFontStyle; // set canvas font
        console.log(testFontStyle);

        const textMetrics = ctx.measureText(sampleText); // a character with the maximum height

        fakeHeight =
          textMetrics.fontBoundingBoxAscent +
          textMetrics.fontBoundingBoxDescent;
        realHeight =
          textMetrics.actualBoundingBoxAscent +
          textMetrics.actualBoundingBoxDescent;

        ctx.beginPath();
        ctx.fillStyle = "#ebebeb";
        ctx.fillRect(
          sampleTextX,
          sampleTextY - textMetrics.fontBoundingBoxAscent,
          textMetrics.width,
          fakeHeight
        );
        ctx.stroke();
        ctx.fillStyle = "black";

        ctx.fillText(sampleText, sampleTextX, sampleTextY);

        document.getElementById("fakeHeight").innerText =
          "Fake Height: " + fakeHeight;
        document.getElementById("realHeight").innerText =
          "Real Height: " + realHeight;

        const baselinesAboveAlphabetic = [
          // "fontBoundingBoxAscent",
          "actualBoundingBoxAscent",
          // "hangingBaseline",
          "alphabeticBaseline",
        ];
        const baselinesBelowAlphabetic = [
          // "ideographicBaseline",
          // "emHeightDescent",
          "actualBoundingBoxDescent",
          // "fontBoundingBoxDescent",
        ];
        const baselines = [
          ...baselinesAboveAlphabetic,
          ...baselinesBelowAlphabetic,
        ];
        // ctx.font = "25px serif";
        ctx.strokeStyle = "red";

        baselines.forEach((baseline) => {
          const text = `Abcdefghijklmnop (${baseline})`;
          // const textMetrics = ctx.measureText(sampleText);
          const y = sampleTextY;
          ctx.beginPath();
          // ctx.fillText(text, 0, y);

          const baselineMetricValue = textMetrics[baseline];
          if (baselineMetricValue === undefined) {
            return;
          }

          const lineY = baselinesBelowAlphabetic.includes(baseline)
            ? y + Math.abs(baselineMetricValue)
            : y - Math.abs(baselineMetricValue);
          ctx.moveTo(sampleTextX, lineY);
          ctx.lineTo(sampleTextX + textMetrics.width, lineY);
          ctx.stroke();
          ctx.font = "25px serif";
          ctx.fillText(baseline, sampleTextX + textMetrics.width + 50, lineY);
        });
      }
      drawPreview();
    </script>
  </body>
</html>
