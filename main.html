<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Real Text Size</title>
  </head>
  <body>
    <h1>Real Text Size</h1>
    <p>Pick a font</p>
    <!-- <div id="font-picker"></div> -->

    <canvas
      id="Canvas"
      width="1000"
      height="600"
      style="border: 1px solid black"
    ></canvas>

    <div id="fakeHeight"></div>
    <div id="realHeight"></div>

    <script src="FontPicker.ts"></script>
    <script>
      // const fontPicker = new FontPicker(
      // 	"", // Google API key
      // 	"Arial", // Default font
      // 	{ limit: 30 }, // Additional options
      // );

      // measure real body text size
      const sampleText = "Apd";
      const c = document.getElementById("Canvas"); // get canvas element
      const ctx = c.getContext("2d"); // classify it as a 2D space

      c.style.width = "500px";
      c.style.height = "300px";

      // const testFontStyle = typeSize + typeUnits + " " + currentFont;
      const testFontStyle = "240pt Arial";
      ctx.font = testFontStyle; // set canvas font
      console.log(testFontStyle);

      // ctx.beginPath()
      ctx.fillText(sampleText, 100, 500);

      const textMetrics = ctx.measureText(sampleText); // a character with the maximum height

      fakeHeight =
        textMetrics.fontBoundingBoxAscent + textMetrics.fontBoundingBoxDescent;
      realHeight =
        textMetrics.actualBoundingBoxAscent +
        textMetrics.actualBoundingBoxDescent;

      document.getElementById("fakeHeight").innerText =
        "Fake Height: " + fakeHeight;
      document.getElementById("realHeight").innerText =
        "Real Height: " + realHeight;

      const baselinesAboveAlphabetic = [
        "fontBoundingBoxAscent",
        "actualBoundingBoxAscent",
        "hangingBaseline",
        "textBaseline"
      ];
      const baselinesBelowAlphabetic = [
        "ideographicBaseline",
        "emHeightDescent",
        "actualBoundingBoxDescent",
        "fontBoundingBoxDescent",
      ];
      const baselines = [
        ...baselinesAboveAlphabetic,
        ...baselinesBelowAlphabetic,
      ];
      // ctx.font = "25px serif";
      ctx.strokeStyle = "red";

      baselines.forEach((baseline) => {
        const text = `Abcdefghijklmnop (${baseline})`;
        const textMetrics = ctx.measureText(sampleText);
        const y = 500;
        ctx.beginPath();
        // ctx.fillText(text, 0, y);

        const baselineMetricValue = textMetrics[baseline];
        if (baselineMetricValue === undefined) {
          return;
        }

        const lineY = baselinesBelowAlphabetic.includes(baseline)
          ? y + Math.abs(baselineMetricValue)
          : y - Math.abs(baselineMetricValue);
        ctx.moveTo(0, lineY);
        ctx.lineTo(550, lineY);
        ctx.stroke();
        ctx.font = "25px serif";
        ctx.fillText(baseline, 700, lineY);
      });
    </script>
  </body>
</html>
